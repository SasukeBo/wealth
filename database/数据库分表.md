# 数据库分表

分表的目的就在于，减小数据库的负担。

mysql 中有一种机制是表锁定和行锁定，是为了保证数据的完整性。

## 性能问题分析

### 数据量

单库数据量在 5000w 以内性能比较好
单表数据量是 500w-1000w 之间性能比较好

### 磁盘

磁盘 IO 压力

### 数据库连接

数据库连接是非常稀少的资源，当一个库里既有用户、商品、订单相关的数据，当海量用户同时操作时，数据库连接就很可能成为瓶颈。

## 拆分概念：

### 垂直拆分

#### 垂直分库

垂直分库针对的是一个系统中的不同业务进行拆分。比如用户一个库，商品一个库，订单一个库。
一个购物网站对外提供服务时，会同时对用户、商品、订单进行操作，没拆分之前，全部处理都落到单一的库上
所以需要将不同业务的数据拆分到不同的服务器上建立数据库。

#### 垂直分表

一般针对字段较多的大表，拆分为字段相对较少的拓展表，避免查询时数据量太大造成跨页问题。

### 水平拆分

#### 水平分表

设置单表数据量阈值，当超出阈值时则通过程序创建新表或者选择其他有空余的表

#### 水平分库分表

将单张表的数据切分到多个服务器的相应表上，表中数据集不同，表结构一致。


## 分表策略

- HASH取模，id对n取模建表，需要建立n个表，类似于内存片选
- 阈值分表，取值范围1-10k, 100001 - 20000 ...
- 地理位置分片，华南区一个表，华北区一个表
- 时间分片，按月份按季度等，可以做到冷热数据

